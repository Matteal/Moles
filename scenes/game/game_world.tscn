[gd_scene load_steps=6 format=2]

[ext_resource path="res://scenes/game/levels/cave.tscn" type="PackedScene" id=1]
[ext_resource path="res://scenes/game/blocks/rectangle.tscn" type="PackedScene" id=3]
[ext_resource path="res://scenes/game/blocks/square.tscn" type="PackedScene" id=5]
[ext_resource path="res://scenes/game/blocks/slope.tscn" type="PackedScene" id=6]

[sub_resource type="GDScript" id=1]
script/source = "extends Node

var num_players: int = 2 # number of joysticks connected

var players: Array = [] # array to hold player instances
var input_maps: Array = [] # array to hold input_map dict for each player

var window_height = ProjectSettings.get_setting(\"display/window/size/height\")
var window_width = ProjectSettings.get_setting(\"display/window/size/width\")

var spawn_corner_bottom = Vector2(160, 0)
var spawn_corner_up = Vector2(850, -300)

#load blocks
var Square = load(\"res://scenes/game/blocks/square.tscn\")
var Rectangle = load(\"res://scenes/game/blocks/rectangle.tscn\")
var Slope = load(\"res://scenes/game/blocks/slope.tscn\")

var Player = load(\"res://scenes/game/characters/player.tscn\")

# Called when the node enters the scene tree for the first time.
func _ready():
	for player_index in range(num_players):
		var spawn = get_node(\"Level/SpawnPoint{n}\".format({\"n\":player_index}))
		var new_player = Player.instance()
		add_child(new_player)
		
		new_player.player_index = player_index
		new_player.global_transform.origin = spawn.global_transform.origin
		
		players.append(new_player)
		
	randomize()
	print(\"world\")
	pass # Replace with function body.
	

func _process(delta):
	if Input.is_action_just_pressed(\"generate\"):
		generate()
		


# Called every frame. 'delta' is the elapsed time since the previous frame.
func generate():
	var crate
	match randi()%3:
		0:
			crate = Square.instance()
		1:
			crate = Rectangle.instance()
		2:
			crate = Slope.instance()
	get_node(\"obstacles\").add_child(crate)
	var pos = Vector2(randi()%int(spawn_corner_up.x - spawn_corner_bottom.x), -randi()%int(spawn_corner_up.y - spawn_corner_bottom.y))
	crate.global_transform.origin = pos + spawn_corner_bottom
"

[node name="Game_world" type="Node"]
script = SubResource( 1 )

[node name="obstacles" type="Node" parent="." groups=["bodies"]]

[node name="rectangle" parent="obstacles" instance=ExtResource( 3 )]
position = Vector2( 656, 430 )

[node name="square" parent="obstacles" instance=ExtResource( 5 )]
position = Vector2( 676, 478 )

[node name="square2" parent="obstacles" instance=ExtResource( 5 )]
position = Vector2( 629, 373 )

[node name="slope" parent="obstacles" instance=ExtResource( 6 )]
position = Vector2( 478, 482 )

[node name="Level" parent="." instance=ExtResource( 1 )]

[node name="Camera" type="Camera2D" parent="."]
anchor_mode = 0
current = true
drag_margin_h_enabled = true
drag_margin_v_enabled = true
